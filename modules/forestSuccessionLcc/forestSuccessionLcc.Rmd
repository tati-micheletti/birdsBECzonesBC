---
title: "forestSuccessionLcc"
author: "LCC05 Creators: Alex Chubaty & Eliot McIntire; forestSucessionLcc author: Tati Micheletti" 
date: "15 Dec 2017"
output: html_document
---

This is a simple example model of forest succession and aging. It is based on the LCC05 **without** fire and caribou modules. It was designed to easily select any canadian territory or city as study area. Such as the LCC05, it includes simple versions of forest succession in Canada's boreal forest, some GIS data operations to select the subset area (study area), and a reclassification module from a many-class land cover to a few-class land cover.
These are all toy versions of each of these types and so are not useful for real world applications; but they allow highlighting of some of `SpaDES`'s capabilities.

This example uses the notion of a 'module group' or 'parent' module that contains several child modules:

- `cropReprojectLccAge`
- `forestAge`
- `forestSuccessionBeacons`
- `LccToBeaconsReclassify`

The code will download all modules and data required to run the `spades` call at the end.
Visualizations will be quick because a device will be opened that is not within RStudio.

```{r download-modules, eval=FALSE}
library(SpaDES)

# set the main working directory
workDirectory <- file.path(dirname(tempdir()), "forestSuccessionLcc")

# set the directories
inputDir <-  file.path(workDirectory, "inputs")
moduleDir <- file.path(workDirectory, "modules")
outputDir <- file.path(workDirectory, "outputs")
cacheDir <- file.path(workDirectory, "cache")

setPaths(modulePath = moduleDir, inputPath = inputDir, outputPath = outputDir, cachePath = cacheDir)

# Alternatively, directory paths can be created using `checkPaths`
checkPath(moduleDir, create = TRUE)

downloadModule("forestSuccessionLcc", moduleDir) # default `data=FALSE` doesn't download data
```

"forestSuccessionLcc" is a module group or metamodule. Module groups make loading multiple modules easier: only the name of the module group needs to be specified in the `simInit` call, which will then initialize the simulation with the child modules. 

```{r module-group-init, eval=FALSE}
# setup simulation

times <- list(start = 2005.0, end = 2010.0, timeunit = "year")
parameters <- list(
  .globals = list()
)

modules <- list("forestSuccessionLcc")
paths <- list(
  cachePath = cacheDir,
  modulePath = moduleDir,
  inputPath = inputDir,
  outputPath = outputDir
)

# This next step will set up the simulation using the defined parameters. It will also download data if they do not yet exist locally
mySim <- simInit(times = times, params = parameters, modules = modules, paths = paths)
```

Now that the `mySim` object has been initialized, we can run the simulation by calling `spades`:

```{r run-SpaDES, eval=FALSE}
dev.useRSGD(FALSE) # do not use Rstudio graphics device
dev() # opens external (non-RStudio) device, which is faster
clearPlot()

mySimOut <- spades(mySim, debug = TRUE)

# Plot Canada Map
Plot(mySimOut$lcc05, title = "Land Cover, with simulated area")
# Plot small Yellow polygon showing area simulated
Plot(mySimOut$inputMapPolygon, addTo = "mySimOut$lcc05", gp = gpar(col = "yellow", lwd = 2))
```

In addition to running a model, there are many things built into SpaDES that allow a user to explore the modules and models.

```{r Exploring model, eval = FALSE}
openModules(mySim) # this will try to open the modules in a text editor, or give instructions how to do it manually

### Simulation overview: note the child modules are initialized
moduleDiagram(mySim)
objectDiagram(mySim)

# show modules that are included in this simList
modules(mySim)

# show all objects contained within the final simList
ls(mySimOut)

# more detail
ls.str(mySimOut)

# show parameters that can easily be changed in simInit call
params(mySim)
```

